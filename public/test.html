<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>Appmedo Gemini ç”Ÿåœ–æ¸¬è©¦</title>
  <style>body{font-family:Arial;max-width:800px;margin:0 auto;padding:20px;}#preview{max-width:100%;border:1px solid #ccc;}</style>
</head>
<body>
  <h1>ğŸš€ Gemini 3 Pro Image Preview ç”Ÿåœ–</h1>
  <textarea id="prompt" placeholder="æè¿°åœ–åƒï¼Œå¦‚ï¼šé¦™æ¸¯ Sha Tin å¤œæ™¯ï¼Œå‹•æ¼«é¢¨" rows="3" style="width:100%;"></textarea><br>
  <label>ä¸Šå‚³åƒè€ƒåœ–ï¼ˆé¸å¡«ï¼‰ï¼š<input type="file" id="image" accept="image/*"></label><br>
  <button onclick="generate()">ç”Ÿæˆåœ–åƒ</button>
  <div id="status">å°±ç·’</div>
  <img id="preview" style="display:none;">
  <a id="download" style="display:none;">ä¸‹è¼‰ PNG</a>
  <pre id="log"></pre>

  <script>
    async function generate() {
      const btn = event.target;
      btn.disabled = true;
      btn.textContent = 'ç”Ÿæˆä¸­...';
      const status = document.getElementById('status');
      const preview = document.getElementById('preview');
      const download = document.getElementById('download');
      const log = document.getElementById('log');
      status.textContent = 'ç™¼é€è«‹æ±‚...';

      try {
        const prompt = document.getElementById('prompt').value;
        const file = document.getElementById('image').files[0];
        const parts = [{text: prompt}];
        if (file) {
          const data = await file.arrayBuffer();
          const base64 = btoa(String.fromCharCode(...new Uint8Array(data)));
          parts.push({inline_data: {mime_type: file.type, data: base64}});
        }

        const resp = await fetch('/v1beta/models/gemini-3-pro-image-preview:generateContent', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({
            contents: [{role: 'user', parts}],
            generation_config: {response_mime_type: 'image/png'}
          })
        });

        const data = await resp.json();
        log.textContent = JSON.stringify(data, null, 2);

        if (data.data?.[0]?.b64_json) {
          const imgSrc = `data:image/png;base64,${data.data[0].b64_json}`;
          preview.src = imgSrc;
          preview.style.display = 'block';
          download.href = imgSrc;
          download.download = 'gemini-image.png';
          download.style.display = 'block';
          status.textContent = 'âœ… ç”ŸæˆæˆåŠŸ';
          status.style.color = 'green';
        } else {
          status.textContent = 'âš ï¸ ç„¡åœ–åƒè³‡æ–™';
          status.style.color = 'orange';
        }
      } catch (e) {
        status.textContent = `âŒ éŒ¯èª¤ï¼š${e.message}`;
        status.style.color = 'red';
        log.textContent += `\néŒ¯èª¤ï¼š${e.message}`;
      } finally {
        btn.disabled = false;
        btn.textContent = 'ğŸš€ ç”Ÿæˆåœ–åƒ';
      }
    }
  </script>
</body>
</html>
